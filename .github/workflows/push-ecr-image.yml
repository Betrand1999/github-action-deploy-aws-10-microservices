name: build docker image and push to ecr 
on:
 push:
  branches:
    - dev-branch 
jobs:
  build:
   runs-on: ubuntu-latest 
   steps:
     - name: checkout github repo 
       uses: actions/checkout@v2 
     - name: login to aws ECR 
       env:
        AWS_ACCESS_KEY_ID: ${{secrets.AWS_ACCESS_KEY_ID}}
        AWS_SECRET_ACCESS_KEY: ${{secrets.AWS_SECRET_ACCESS_KEY}}
        AWS_DEFAULT_REGION: us-east-1
       run: ls
        
     - name: build docker image 
       run: docker build -t ecr-repo . 
     - name: run image 
       run: docker run -d -p 8081:80 ecr-repo
     - name: tag image 
       run: docker tag docker tag ecr-repo:latest 058264368002.dkr.ecr.us-east-1.amazonaws.com/ecr-repo:latest
     - name: push the image 
       run: docker push docker push 058264368002.dkr.ecr.us-east-1.amazonaws.com/ecr-repo:latest